{% extends "merchstore/layout.html" %}
{% block body %}

<h1>TRANSACTION VIEW (see what you SOLD)</h1>
<h2>Transactions grouped by buyer</h2>

<!-- help from AI: -->
<!-- This groups the transactions list by the buyer field.
The result is stored in a new variable called buyer_groups.
Each item in buyer_groups contains 2 fields:
grouper: the buyer object (a Profile)
list: a list of transactions for that buyer -->
{% regroup transactions by buyer as buyer_groups %}

{% if buyer_groups %}
    {% for group in buyer_groups %}
        <h3>Buyer: {{ group.grouper.user.username }}</h3>
        <ul>
            {% for transaction in group.list %}
                <li>
                    <strong>Product:</strong> {{ transaction.product.name }} |
                    <strong>Amount:</strong> {{ transaction.amount }} |
                    <strong>Status:</strong> {{ transaction.get_status_display }} |
                    <strong>Date:</strong> {{ transaction.created_on|date:"Y-m-d H:i" }}
                </li>
            {% endfor %}
        </ul>
        <hr>
    {% endfor %}
{% else %}
    <p>No transactions found.</p>
{% endif %} 

<a href="{% url 'merchstore:show_products_list'%}">Back to list of all products!</a>

{% endblock %}